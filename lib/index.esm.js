var e,t;let i="honey",s="__visible";class r{constructor(e,t="-2%"){this.rootMargin=t,this.observer=new IntersectionObserver(t=>{t.forEach(t=>{let i=e.getElement(t.target);t.isIntersecting&&!i.visible&&i.show().then(()=>{})})},{rootMargin:this.rootMargin,threshold:.05})}clear(){this.observer.disconnect()}add(e){this.observer.observe(e.node)}}let n=/url\(\s*(['"]?)(.*)\1\s*\)/;async function a(e){return await new Promise(t=>{let i=new Image;i.onload=()=>{t(!0)},i.onerror=()=>{t(!1)},i.src=e})}async function o(e){await new Promise(t=>setTimeout(t,e))}!function(e){e.top="top",e.right="right",e.bottom="bottom",e.left="left"}(e||(e={}));let l="IntersectionObserver"in window;function c(e,t=0){return e?parseInt(e,10):t}function h(e,t){return e.hasOwnProperty(t)}!function(e){e[e.Hidden=0]="Hidden",e[e.Exposing=1]="Exposing",e[e.Exposed=2]="Exposed"}(t||(t={}));class d{constructor(i){this.node=i,this.images=[],this.state=t.Hidden,this.params=function(t){return{effect:t.effect?t.effect:"slide",direction:t.left?e.left:t.right?e.right:t.bottom?e.bottom:e.top,origin:t.origin?t.origin:e.top,scale:function(e,t=0){return e?parseFloat(e):t}(t.scale,.87),offset:t.up?c(t.up):t.left?c(t.left):t.right?c(t.right):t.bottom?c(t.bottom):32,duration:c(t.duration,640),delay:c(t.delay,0),expose:l&&h(t,"expose"),await:t.await??"",continue:h(t,"continue"),spin:h(t,"spin"),spinSize:c(t.spinSize,24)}}(i.dataset),this.images=function(e){let t=[],i=Array.from(e.querySelectorAll("*"));i.push(e);for(let e=0;e<i.length;e++)if(i[e]?.tagName==="IMG")t.push(i[e].src);else{let s=function(e){let t=getComputedStyle(e),i=[t.background,t.backgroundImage];for(let e=0;e<i.length;e++){let t=function(e){if(!e||""===e)return;let t=e.match(n);if(null!==t)return t[2]}(i[e]);if(t)return t}}(i[e]);s&&t.push(s)}return t}(i)}setAwaited(e){this.awaitedElement=e}get visible(){return this.state!==t.Hidden}async ready(){this.awaitedElement&&await this.awaitedElement.whenVisible(),await this.imagesLoaded(),this.params.delay>0&&await o(this.params.delay)}async whenVisible(){for(;!this.visible;)await o(10)}async imagesLoaded(){let e=this.images.map(a),t=await Promise.all(e);return!t.some(e=>!e)}hide(){this.node.classList.remove(s),this.state=t.Hidden}showSpinner(){this.spinner=function(e){var t;let i=document.createElement("div");i.className="honey-spin",i.innerHTML=(t=e.params.spinSize,`<svg width="${t}" height="${t}" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="animation: honeySpin 1.7s linear infinite"><circle cx="50" cy="50" fill="none" stroke="var(--honey-spinner)" stroke-width="10" r="35" stroke-dasharray="90 60"></circle></svg>`);let s=document.documentElement,r=e.node.getBoundingClientRect();return!function(e,t){let i=Object.keys(t);for(let s=0;s<i.length;s++){let r=i[s];e.style[r]=t[r]}}(i,{position:"absolute",top:`${r.top+s.scrollTop}px`,left:`${r.left+s.scrollLeft}px`,width:`${r.width}px`,height:`${r.height}px`,display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity .23s ease-out"}),document.body.appendChild(i),setTimeout(()=>{i.style.opacity="1"},50),i}(this)}async show(){var i;if(this.visible)return;this.state=t.Exposing,this.spinner&&(i=this.spinner,requestAnimationFrame(()=>{i.style.opacity="0",setTimeout(()=>{document.body.removeChild(i)},300)}));let[r,n]=function(t){let i,s;let r={opacity:"0"},n={opacity:"1",transform:"scale(1) scaleY(1) scaleX(1) rotate(0deg)"};switch(t.effect){case"zoom":r.transform=`scale(${t.scale})`,i="cubic-bezier(0,.7,.3,1)";break;case"helix":r.transform=`scale(${t.scale}) rotate(90deg)`,i="cubic-bezier(0,.75,.25,1)";break;case"relax":r.transform=`scaleY(${t.scale})`,r.transformOrigin=t.origin,n.transformOrigin=t.origin,i="cubic-bezier(0,0,0,1)";break;default:var a,o;r.transform=(a=t.direction,o=t.offset,s=a===e.top||a===e.bottom?"Y":"X",`translate${s+=a===e.left||a===e.top?"(-":"("}${o}px)`),r.transformOrigin=t.origin,n.transformOrigin=t.origin,i="cubic-bezier(0,.9,.1,1)"}return[[r,n],{easing:i,duration:t.duration,iterations:1}]}(this.params),a=this.node.animate(r,n);await a.finished,this.node.classList.add(s),this.state=t.Exposed}}let u=new class{has(e){return this.storage.has(e)}clear(){this.storage.clear()}getElement(e){if(this.storage.has(e))return this.storage.get(e);let t=new d(e);return this.storage.set(e,t),t}getAwaited(e){if(e.params.continue){if(this.storage.size>0)return this.getByIndex(this.storage.size-2)}else if(e.params.await){let t=document.getElementById(e.params.await);return t?this.getElement(t):void 0}}get size(){return this.storage.size}getByIndex(e){let t=Array.from(this.storage.keys())[e];return this.storage.get(t)}add(e){if(this.storage.has(e))throw Error("Element already exists");let t=new d(e);return this.storage.set(e,t),t}constructor(){this.storage=new Map}},m=new r(u);function f(e=document,t){let n=Array.from(e.querySelectorAll(`.${i}:not(.${s})`)),a=new r(u),o=n.map(e=>{let i=u.getElement(e);t&&(i.params=t(i.params)),i.params.spin&&i.showSpinner();let s=u.getAwaited(i);return(s&&i.setAwaited(s),i.params.expose)?i.ready().then(()=>a.add(i)):i.ready().then(()=>i.show())});return Promise.all(o)}function g(e=document){let t=e.querySelectorAll(`.${i}.${s}`);t.forEach(e=>{e.classList.remove(s)});let r=document.querySelectorAll(".honey-spin");r.forEach(e=>document.body.removeChild(e)),u.clear(),m.clear()}export{f as animate,g as reset};
//# sourceMappingURL=index.esm.js.map
